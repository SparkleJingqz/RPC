# SimpleRPCFrame

RPC: Remote Procedure Call - 远程过程调用，是一种通过网络从远程计算机程序上 请求服务，而不需要了解底层网络技术的协议。对应客户端只有通用接口却想要去执行服务端提供的实现类函数/方法，需通过网络来传达调用的语义与数据。

![RpcStructure2](./static/RpcStructure2.jpg)

**服务寻址** -- 基于Nacos实现服务的注册与发现，通过一定的负载均衡策略寻找合适的服务提供方地址

**传输方式** -- 使用Java原生Socket版本实现网络传输，实现自定义顶层传输协议，序列化方式可通过Java原生ObjectStream、Json、Kryo序列化方式。

**客户端获取结果** -- 动态代理

**服务器执行方法** -- 反射调用

## 架构

**服务端注册方式**：将@Service注解的服务实现类以interface-implement方式注册到服务端本地实现查询表，并以interface-host方式注册到Nacos服务中心。

**客户端发现服务**：客户端根据自己所调用的通用接口向Nacos获取自己的服务提供端地址，传输获取响应后以动态代理方式获取执行结果。

客户端与服务器可自行选择序列化方式来序列化传输内容。

服务器可自行选择负载均衡方式来管理客户端的请求调用。

## 项目模块概览 (final)

- **RPC-api**	——	服务的通用接口
- **RPC-common**	——	实体对象、工具类等公用类
- **RPC-core**	——	框架的核心实现
- **RPC-run**	——	部署服务实现类&C\S启动类

## 特性

- 实现了基于 Java 原生 Socket - BIO网络传输方式，实现自定义的应用层传输协议
- 实现了三种序列化方式：Java原生对象流、Json 方式、Kryo 方式
- 实现了两种负载均衡算法：随机算法与轮转算法
- 使用 Nacos 作为注册中心，管理服务提供者信息
- 实现基于注解的服务端自动注册服务功能
- 项目抽象化良好，模块耦合度低，网络传输、序列化器、负载均衡算法可配置

## 自定义传输协议

自定义传输协议结构如下 - 防止拆/粘包：

```
+---------------+---------------+-----------------+-------------+
|  Magic Number |  Package Type | Serializer Type | Data Length |
|    4 bytes    |    4 bytes    |     4 bytes     |   4 bytes   |
+---------------+---------------+-----------------+-------------+
|                          Data Bytes                           |
|                   Length: ${Data Length}                      |
+---------------------------------------------------------------+
```

| 字段            |                             解释                             |
| :-------------- | :----------------------------------------------------------: |
| Magic Number    |              魔数，标识自定义协议包，0xCAFEBABE              |
| Package Type    | 包类型，标明这是一个调用请求RpcRequest还是调用响应RpcResponse |
| Serializer Type |     序列化器类型，标明这个包的数据的序列化方式Json/Kryo      |
| Data Length     |                        数据字节的长度                        |
| Data Bytes      |    字节流数据，根据DataLength确定当前反序列化的字节流长度    |

## 启动注意

在此之前请确保 Nacos 运行在本地 `8848` 端口(默认)。

- 可配置本项目static目录中的nacos-start.bat，将nacos-develop目录更改为本地目录。